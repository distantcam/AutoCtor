<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /readme.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# AutoCtor

[![Build Status](https://img.shields.io/github/actions/workflow/status/distantcam/autoctor/build.yml)](https://github.com/distantcam/AutoCtor/actions/workflows/build.yml)
[![NuGet Status](https://img.shields.io/nuget/v/AutoCtor.svg)](https://www.nuget.org/packages/AutoCtor/)
[![Nuget Downloads](https://img.shields.io/nuget/dt/autoctor.svg)](https://www.nuget.org/packages/AutoCtor/)


AutoCtor is a Roslyn Source Generator that will automatically create a constructor for your class for use with constructor Dependency Injection.

```diff
+[AutoConstruct]
public partial class AService
{
    private readonly IDataContext _dataContext;
    private readonly IDataService _dataService;
    private readonly IExternalService _externalService;
    private readonly ICacheService _cacheService;
    private readonly ICacheProvider _cacheProvider;
    private readonly IUserService _userService;

-    public AService(
-        IDataContext dataContext,
-        IDataService dataService,
-        IExternalService externalService,
-        ICacheService cacheService,
-        ICacheProvider cacheProvider,
-        IUserService userService
-    )
-    {
-        _dataContext = dataContext;
-        _dataService = dataService;
-        _externalService = externalService;
-        _cacheService = cacheService;
-        _cacheProvider = cacheProvider;
-        _userService = userService;
-    }
}
```

<a id='toc'></a>
<!-- toc -->
## Contents

  * [NuGet packages](#nuget-packages)
  * [Examples](#examples)
    * [Basic](#basic)
    * [Inherited](#inherited)
    * [Properties](#properties)
  * [Post Constructor Initialization](#post-constructor-initialization)
    * [Extra Parameters](#extra-parameters)
    * [`out`/`ref` Parameters](#outref-parameters)
    * [Optional Parameters](#optional-parameters)
  * [Argument Guards](#argument-guards)
  * [Keyed Services](#keyed-services)
  * [Other](#other)
    * [Embedding The Attributes](#embedding-the-attributes)
    * [Keeping Attributes In Code](#keeping-attributes-in-code)
  * [Stats](#stats)<!-- endToc -->

## NuGet packages

https://nuget.org/packages/AutoCtor/

## Examples

### Basic

<!-- snippet: Basic -->
<a id='snippet-Basic'></a>
```cs
[AutoConstruct]
public partial class Basic
{
    private readonly IService _service;
    private readonly IList<string> _list = new List<string>();
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Basic.cs#L6-L15' title='Snippet source file'>snippet source</a> | <a href='#snippet-Basic' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: Basic.ExamplesGeneratedCode#Basic.g.verified.cs -->
<a id='snippet-Basic.ExamplesGeneratedCode#Basic.g.verified.cs'></a>
```cs
//HintName: Basic.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class Basic
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public Basic(global::IService service)
	{
		this._service = service;
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Basic.ExamplesGeneratedCode#Basic.g.verified.cs#L1-L16' title='Snippet source file'>snippet source</a> | <a href='#snippet-Basic.ExamplesGeneratedCode#Basic.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### Inherited

<!-- snippet: Inherited -->
<a id='snippet-Inherited'></a>
```cs
public abstract class BaseClass
{
    protected IAnotherService _anotherService;

    public BaseClass(IAnotherService anotherService)
    {
        _anotherService = anotherService;
    }
}

[AutoConstruct]
public partial class Inherited : BaseClass
{
    private readonly IService _service;
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Inherited.cs#L6-L24' title='Snippet source file'>snippet source</a> | <a href='#snippet-Inherited' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: Inherited.ExamplesGeneratedCode#Inherited.g.verified.cs -->
<a id='snippet-Inherited.ExamplesGeneratedCode#Inherited.g.verified.cs'></a>
```cs
//HintName: Inherited.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class Inherited
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public Inherited(
		global::IAnotherService anotherService,
		global::IService service
	) : base(anotherService)
	{
		this._service = service;
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Inherited.ExamplesGeneratedCode#Inherited.g.verified.cs#L1-L19' title='Snippet source file'>snippet source</a> | <a href='#snippet-Inherited.ExamplesGeneratedCode#Inherited.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### Properties

<!-- snippet: Properties -->
<a id='snippet-Properties'></a>
```cs
// AutoCtor will initialize these
public string GetProperty { get; }
protected string ProtectedProperty { get; }
public string InitProperty { get; init; }
public required string RequiredProperty { get; set; }

// AutoCtor will ignore these
public string InitializerProperty { get; } = "Constant";
public string GetSetProperty { get; set; }
public string FixedProperty => "Constant";
public string RedirectedProperty => InitializerProperty;
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Properties.cs#L4-L18' title='Snippet source file'>snippet source</a> | <a href='#snippet-Properties' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: Properties.ExamplesGeneratedCode#Properties.g.verified.cs -->
<a id='snippet-Properties.ExamplesGeneratedCode#Properties.g.verified.cs'></a>
```cs
//HintName: Properties.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class Properties
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public Properties(
		string getProperty,
		string protectedProperty,
		string initProperty,
		string requiredProperty
	)
	{
		this.GetProperty = getProperty;
		this.ProtectedProperty = protectedProperty;
		this.InitProperty = initProperty;
		this.RequiredProperty = requiredProperty;
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Properties.ExamplesGeneratedCode#Properties.g.verified.cs#L1-L24' title='Snippet source file'>snippet source</a> | <a href='#snippet-Properties.ExamplesGeneratedCode#Properties.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

<a href='#toc' title='Back to Contents'>Back to Contents</a>
## Post Constructor Initialization

You can mark a method to be called at the end of the constructor with the attribute `[AutoPostConstruct]`. This method must return void.

<!-- snippet: PostConstruct -->
<a id='snippet-PostConstruct'></a>
```cs
[AutoConstruct]
public partial class PostConstruct
{
    private readonly IService _service;

    [AutoPostConstruct]
    private void Initialize()
    {
    }
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstruct.cs#L5-L18' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstruct' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: PostConstruct.ExamplesGeneratedCode#PostConstruct.g.verified.cs -->
<a id='snippet-PostConstruct.ExamplesGeneratedCode#PostConstruct.g.verified.cs'></a>
```cs
//HintName: PostConstruct.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class PostConstruct
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public PostConstruct(global::IService service)
	{
		this._service = service;
		Initialize();
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstruct.ExamplesGeneratedCode#PostConstruct.g.verified.cs#L1-L17' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstruct.ExamplesGeneratedCode#PostConstruct.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### Extra Parameters

Post construct methods can also take parameters. The generated constructor will include these parameters.

<!-- snippet: PostConstructWithParameter -->
<a id='snippet-PostConstructWithParameter'></a>
```cs
[AutoConstruct]
public partial class PostConstructWithParameter
{
    private readonly IService _service;

    [AutoPostConstruct]
    private void Initialize(IInitializeService initialiseService)
    {
    }
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithParameter.cs#L6-L19' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithParameter' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: PostConstructWithParameter.ExamplesGeneratedCode#PostConstructWithParameter.g.verified.cs -->
<a id='snippet-PostConstructWithParameter.ExamplesGeneratedCode#PostConstructWithParameter.g.verified.cs'></a>
```cs
//HintName: PostConstructWithParameter.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class PostConstructWithParameter
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public PostConstructWithParameter(
		global::IService service,
		global::IInitializeService initialiseService
	)
	{
		this._service = service;
		Initialize(initialiseService);
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithParameter.ExamplesGeneratedCode#PostConstructWithParameter.g.verified.cs#L1-L20' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithParameter.ExamplesGeneratedCode#PostConstructWithParameter.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### `out`/`ref` Parameters

Parameters marked with `out` or `ref` are set back to any fields that match the same type. This can be used to set readonly fields with more complex logic.

<!-- snippet: PostConstructWithOutParameter -->
<a id='snippet-PostConstructWithOutParameter'></a>
```cs
[AutoConstruct]
public partial class PostConstructWithOutParameter
{
    private readonly IService _service;
    private readonly IOtherService _otherService;

    [AutoPostConstruct]
    private void Initialize(IServiceProvider services, out IService service)
    {
        service = services.GetService<IService>();
    }
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithOutParameter.cs#L7-L22' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithOutParameter' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: PostConstructWithOutParameter.ExamplesGeneratedCode#PostConstructWithOutParameter.g.verified.cs -->
<a id='snippet-PostConstructWithOutParameter.ExamplesGeneratedCode#PostConstructWithOutParameter.g.verified.cs'></a>
```cs
//HintName: PostConstructWithOutParameter.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class PostConstructWithOutParameter
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public PostConstructWithOutParameter(
		global::IOtherService otherService,
		global::IServiceProvider services
	)
	{
		this._otherService = otherService;
		Initialize(services, out this._service);
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithOutParameter.ExamplesGeneratedCode#PostConstructWithOutParameter.g.verified.cs#L1-L20' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithOutParameter.ExamplesGeneratedCode#PostConstructWithOutParameter.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### Optional Parameters

<!-- snippet: PostConstructWithDefaultParameter -->
<a id='snippet-PostConstructWithDefaultParameter'></a>
```cs
[AutoConstruct]
public partial class PostConstructWithDefaultParameter
{
    [AutoPostConstruct]
    private void Initialize(Service? service = default)
    {
    }
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithDefaultParameter.cs#L5-L16' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithDefaultParameter' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: PostConstructWithDefaultParameter.ExamplesGeneratedCode#PostConstructWithDefaultParameter.g.verified.cs -->
<a id='snippet-PostConstructWithDefaultParameter.ExamplesGeneratedCode#PostConstructWithDefaultParameter.g.verified.cs'></a>
```cs
//HintName: PostConstructWithDefaultParameter.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class PostConstructWithDefaultParameter
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public PostConstructWithDefaultParameter(global::Service service = default)
	{
		Initialize(service);
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/PostConstructWithDefaultParameter.ExamplesGeneratedCode#PostConstructWithDefaultParameter.g.verified.cs#L1-L16' title='Snippet source file'>snippet source</a> | <a href='#snippet-PostConstructWithDefaultParameter.ExamplesGeneratedCode#PostConstructWithDefaultParameter.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

<a href='#toc' title='Back to Contents'>Back to Contents</a>
## Argument Guards

Null guards for the arguments to the constructor can be added in 2 ways.

In your project you can add a `AutoCtorGuards` property.

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <AutoCtorGuards>true</AutoCtorGuards>
  </PropertyGroup>

</Project>
```

**OR**

In each `AutoConstruct` attribute you can add a setting to enable/disable guards.

<!-- snippet: Guarded -->
<a id='snippet-Guarded'></a>
```cs
[AutoConstruct(GuardSetting.Enabled)]
public partial class Guarded
{
    private readonly IService _service;
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Guarded.cs#L5-L13' title='Snippet source file'>snippet source</a> | <a href='#snippet-Guarded' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: Guarded.ExamplesGeneratedCode#Guarded.g.verified.cs -->
<a id='snippet-Guarded.ExamplesGeneratedCode#Guarded.g.verified.cs'></a>
```cs
//HintName: Guarded.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class Guarded
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public Guarded(global::IService service)
	{
		this._service = service ?? throw new global::System.ArgumentNullException("service");
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Guarded.ExamplesGeneratedCode#Guarded.g.verified.cs#L1-L16' title='Snippet source file'>snippet source</a> | <a href='#snippet-Guarded.ExamplesGeneratedCode#Guarded.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

<a href='#toc' title='Back to Contents'>Back to Contents</a>
## Keyed Services

When using `Microsoft.Extensions.DependencyInjection` you can mark fields and properties with `[AutoKeyedService]` and it will be included in the constructor.

<!-- snippet: Keyed -->
<a id='snippet-Keyed'></a>
```cs
[AutoConstruct]
public partial class Keyed
{
    [AutoKeyedService("key")]
    private readonly IService _keyedService;
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Keyed.cs#L5-L14' title='Snippet source file'>snippet source</a> | <a href='#snippet-Keyed' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

<details><summary>What gets generated</summary>

<!-- snippet: Keyed.ExamplesGeneratedCode#Keyed.g.verified.cs -->
<a id='snippet-Keyed.ExamplesGeneratedCode#Keyed.g.verified.cs'></a>
```cs
//HintName: Keyed.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

partial class Keyed
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.Diagnostics.DebuggerNonUserCodeAttribute]
	public Keyed(
		[global::Microsoft.Extensions.DependencyInjection.FromKeyedServices("key")] global::IService keyedService
	)
	{
		this._keyedService = keyedService;
	}
}
```
<sup><a href='/src/AutoCtor.Tests/ReadmeExamples/Keyed.ExamplesGeneratedCode#Keyed.g.verified.cs#L1-L18' title='Snippet source file'>snippet source</a> | <a href='#snippet-Keyed.ExamplesGeneratedCode#Keyed.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

<a href='#toc' title='Back to Contents'>Back to Contents</a>
## Other

### Embedding The Attributes

By default, the `[AutoConstruct]` attributes referenced in your project are contained in an external dll. It is also possible to embed the attributes directly in your project. To do this, you must do two things:

1. Define the constant `AUTOCTOR_EMBED_ATTRIBUTES`. This ensures the attributes are embedded in your project.
2. Add `compile` to the list of excluded assets in your `<PackageReference>` element. This ensures the attributes in your project are referenced, instead of the _AutoCtor.Attributes.dll_ library.

Your project file should look like this:

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <!--  Define the MSBuild constant    -->
    <DefineConstants>$(DefineConstants);AUTOCTOR_EMBED_ATTRIBUTES</DefineConstants>
  </PropertyGroup>

  <!-- Add the package -->
  <PackageReference Include="AutoCtor"
                    PrivateAssets="all"
                    ExcludeAssets="compile;runtime" />
<!--                               â˜ Add compile to the list of excluded assets. -->

</Project>
```

<details><summary>What gets generated</summary>

<!-- snippet: GeneratedAttributeTests.AttributeGeneratedCode#AutoConstructAttribute.g.verified.cs -->
<a id='snippet-GeneratedAttributeTests.AttributeGeneratedCode#AutoConstructAttribute.g.verified.cs'></a>
```cs
//HintName: AutoConstructAttribute.g.cs
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by https://github.com/distantcam/AutoCtor
// </auto-generated>
//------------------------------------------------------------------------------

#if AUTOCTOR_EMBED_ATTRIBUTES
namespace AutoCtor
{
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	internal enum GuardSetting
	{
		Default,
		Disabled,
		Enabled
	}
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.AttributeUsage(global::System.AttributeTargets.Class | global::System.AttributeTargets.Struct, AllowMultiple = false, Inherited = false)]
	internal sealed class AutoConstructAttribute : global::System.Attribute
	{
		public AutoConstructAttribute(GuardSetting guard = GuardSetting.Default)
		{
		}
	}
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.AttributeUsage(global::System.AttributeTargets.Method, AllowMultiple = false, Inherited = false)]
	internal sealed class AutoPostConstructAttribute : global::System.Attribute
	{
	}
	[global::System.Runtime.CompilerServices.CompilerGeneratedAttribute]
	[global::System.AttributeUsage(global::System.AttributeTargets.Field | global::System.AttributeTargets.Property, AllowMultiple = false, Inherited = false)]
	internal sealed class AutoConstructIgnoreAttribute : global::System.Attribute
	{
	}
}
#endif
```
<sup><a href='/src/AutoCtor.Tests/GeneratedAttributeTests.AttributeGeneratedCode#AutoConstructAttribute.g.verified.cs#L1-L37' title='Snippet source file'>snippet source</a> | <a href='#snippet-GeneratedAttributeTests.AttributeGeneratedCode#AutoConstructAttribute.g.verified.cs' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

</details>

### Keeping Attributes In Code

The `[AutoConstruct]` attributes are decorated with the `[Conditional]` attribute, so their usage will not appear in the build output of your project. If you use reflection at runtime you will not find the `[AutoConstruct]` attributes.

If you wish to preserve these attributes in the build output, add the define constant `AUTOCTOR_USAGES`.

```xml
<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <!--  Define the MSBuild constant    -->
    <DefineConstants>$(DefineConstants);AUTOCTOR_USAGES</DefineConstants>
  </PropertyGroup>

</Project>
```

<a href='#toc' title='Back to Contents'>Back to Contents</a>
## Stats

![Alt](https://repobeats.axiom.co/api/embed/8d02b2c004a5f958b4365abad3d4d1882dca200f.svg "Repobeats analytics image")
